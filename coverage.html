
<html>
    <head>
        <title>Coverage Report</title>
        
        <style type="text/css">
            body { background-color: #fff; }
            table {
                margin-left: 10px;
                border-collapse: collapse;
            }
            td { 
                background-color: #fff; 
                padding: 2px;
            }
            table.overview td {
                padding-right: 20px;
            }
            td.percent, td.linecount { text-align: right; }
            div.package, #totalcov { 
                color: #fff;
                background-color: #375eab; 
                font-size: 16px;
                font-weight: bold;
                padding: 10px;
                border-radius: 5px 5px 5px 5px;
            }
            div.package, #totalcov { 
                float: right; 
                right: 10px;
            }
            #totalcov { 
                top: 10px;
                position: relative;
                background-color: #fff;
                color: #000;
                border: 1px solid #375eab;
                clear: both;
            }
            #summaryWrapper {
                position: fixed;
                top: 10px;
                float: right;
                right: 10px;

            }
            span.packageTotal {
                float: right;
                color: #000;
            }
            #doctitle { 
                background-color: #fff; 
                font-size: 24px;
                margin-top: 20px;
                margin-left: 10px;
                color: #375eab;
                font-weight: bold;
            }
            #about {
                margin-left: 18px;
                font-size: 10px;
            }
            table tr:last-child td {
                font-weight: bold;
            }
            .functitle, .funcname { 
                text-align: center; 
                font-size: 20px; 
                font-weight: bold; 
                color: 375eab; 
            }
            .funcname {
                text-align: left;
                margin-top: 20px;
                margin-left: 10px;
                margin-bottom: 20px;
                padding: 2px 5px 5px;
                background-color: #e0ebf5;
            }
            table.listing {
                margin-left: 10px;
            }
            table.listing td {
                padding: 0px;
                font-size: 12px;
                background-color: #eee; 
                vertical-align: top;
                padding-left: 10px;
                border-bottom: 1px solid #fff;
            }
            table.listing td:first-child {
                text-align: right;
                font-weight: bold;
                vertical-align: center;
            }
            table.listing tr.miss td {
                background-color: #FFBBB8;
            }
            table.listing tr:last-child td {
                font-weight: normal;
                color: #000;
            }
            table.listing tr:last-child td:first-child {
                font-weight: bold;
            }
            .info {
                margin-left: 10px;
            }
            .info code {
            }
            pre { margin: 1px; }
            pre.cmd { 
                background-color: #e9e9e9;
                border-radius: 5px 5px 5px 5px;
                padding: 10px;
                margin: 20px;
                line-height: 18px;
                font-size; 14px;
            }
            a { 
                text-decoration: none; 
                color: #375eab;
            }
            a:hover { text-decoration: underline; }
            p { margin-left: 10px; }
        </style>
        
    </head>
    <body>
        <div id="doctitle">Coverage Report</div>
    <div id="about">Generated on 16 Sep 17 14:25 +1000 with <a href="https://github.com/matm/gocov-html">gocov-html</a></div><div class="funcname">Report Overview</div><table class="overview">
<tr id="s_pkg_github.com/nickw444/miio-go"><td><code><a href="#pkg_github.com/nickw444/miio-go">github.com/nickw444/miio-go</a></code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/38</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/capability"><td><code><a href="#pkg_github.com/nickw444/miio-go/capability">github.com/nickw444/miio-go/capability</a></code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>15/15</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/device"><td><code><a href="#pkg_github.com/nickw444/miio-go/device">github.com/nickw444/miio-go/device</a></code></td><td class="percent"><code>73.24%</code></td><td class="linecount"><code>52/71</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/device/product"><td><code><a href="#pkg_github.com/nickw444/miio-go/device/product">github.com/nickw444/miio-go/device/product</a></code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/protocol"><td><code><a href="#pkg_github.com/nickw444/miio-go/protocol">github.com/nickw444/miio-go/protocol</a></code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/83</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/protocol/packet"><td><code><a href="#pkg_github.com/nickw444/miio-go/protocol/packet">github.com/nickw444/miio-go/protocol/packet</a></code></td><td class="percent"><code>21.58%</code></td><td class="linecount"><code>30/139</code></td></tr>
<tr id="s_pkg_github.com/nickw444/miio-go/subscription"><td><code><a href="#pkg_github.com/nickw444/miio-go/subscription">github.com/nickw444/miio-go/subscription</a></code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/34</code></td></tr>
<tr><td><code>Report Total</code></td><td class="percent"><code>26.11%</code></td><td class="linecount"><code>100/383</code></td></tr>
</table>
<div id="pkg_github.com/nickw444/miio-go" class="funcname">Package Overview: github.com/nickw444/miio-go <span class="packageTotal">0.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_NewClient"><td><code><a href="#fn_NewClient">NewClient(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_@75:5"><td><code><a href="#fn_@75:5">@75:5(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_Client.subscribe"><td><code><a href="#fn_Client.subscribe">Client.subscribe(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_Client.discover"><td><code><a href="#fn_Client.discover">Client.discover(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_Client.init"><td><code><a href="#fn_Client.init">Client.init(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_Client.SetDiscoveryInterval"><td><code><a href="#fn_Client.SetDiscoveryInterval">Client.SetDiscoveryInterval(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@107:5"><td><code><a href="#fn_@107:5">@107:5(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_@31:22"><td><code><a href="#fn_@31:22">@31:22(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@34:19"><td><code><a href="#fn_@34:19">@34:19(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@37:19"><td><code><a href="#fn_@37:19">@37:19(...)</a></code></td><td><code>github.com/nickw444/miio-go/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/38</code></td></tr>
</table>

<div class="funcname" id="fn_NewClient">func NewClient</div><div class="info"><a href="#s_fn_NewClient">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func NewClient() (*Client, error) {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        clk := clock.DefaultClock{}</pre></code></td></tr><tr><td>30</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        transportFactory := func(crypto packet.Crypto, address net.Addr, requestSocket socket.UDPConn) packet.Transport {</pre></code></td></tr><tr><td>32</td><td><code><pre>                return packet.NewTransport(3, crypto, address, requestSocket, clk)</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        deviceFactory := func(deviceId uint32, transport packet.Transport, seen time.Time) device.Device {</pre></code></td></tr><tr><td>35</td><td><code><pre>                return device.New(deviceId, transport, seen)</pre></code></td></tr><tr><td>36</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        cryptoFactory := func(deviceID uint32, deviceToken []byte, initialStamp uint32, stampTime time.Time) (packet.Crypto, error) {</pre></code></td></tr><tr><td>38</td><td><code><pre>                return packet.NewCrypto(deviceID, deviceToken, initialStamp, stampTime, clk)</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        p, err := protocol.NewProtocol(clk, transportFactory, deviceFactory, cryptoFactory)</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>44</td><td><code><pre>        }</pre></code></td></tr><tr><td>45</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        c := &amp;Client{</pre></code></td></tr><tr><td>47</td><td><code><pre>                SubscriptionTarget: subscription.NewTarget(),</pre></code></td></tr><tr><td>48</td><td><code><pre>                protocol:           p,</pre></code></td></tr><tr><td>49</td><td><code><pre>                quitChan:           make(chan struct{}),</pre></code></td></tr><tr><td>50</td><td><code><pre>        }</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        return c, c.init()</pre></code></td></tr><tr><td>53</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@75:5">func @75:5</div><div class="info"><a href="#s_fn_@75:5">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>75</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                c.RLock()</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                tick := time.Tick(c.discoveryInterval)</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                c.RUnlock()</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>                for {</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>81</td><td><code><pre>                        case &lt;-c.quitChan:</pre></code></td></tr><tr><td>82</td><td><code><pre>                                //common.Log.Debugf(&#34;Quitting discoveryfile loop&#34;)</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                                return</pre></code></td></tr><tr><td>84</td><td><code><pre>                        default:</pre></code></td></tr><tr><td>85</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>87</td><td><code><pre>                        case &lt;-c.quitChan:</pre></code></td></tr><tr><td>88</td><td><code><pre>                                //common.Log.Debugf(&#34;Quitting discovery loop&#34;)</pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>                                return</pre></code></td></tr><tr><td>90</td><td><code><pre>                        case &lt;-tick:</pre></code></td></tr><tr><td>91</td><td><code><pre>                                //common.Log.Debugf(&#34;Performing discovery&#34;)</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                                _ = c.protocol.Discover()</pre></code></td></tr><tr><td>93</td><td><code><pre>                        }</pre></code></td></tr><tr><td>94</td><td><code><pre>                }</pre></code></td></tr><tr><td>95</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.subscribe">func Client.subscribe</div><div class="info"><a href="#s_fn_Client.subscribe">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>101</td><td><code><pre>func (c *Client) subscribe() error {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>        sub, err := c.protocol.NewSubscription()</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                return err</pre></code></td></tr><tr><td>105</td><td><code><pre>        }</pre></code></td></tr><tr><td>106</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        go func() {</pre></code></td></tr><tr><td>108</td><td><code><pre>                for event := range sub.Events() {</pre></code></td></tr><tr><td>109</td><td><code><pre>                        c.Publish(event)</pre></code></td></tr><tr><td>110</td><td><code><pre>                }</pre></code></td></tr><tr><td>111</td><td><code><pre>        }()</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>113</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.discover">func Client.discover</div><div class="info"><a href="#s_fn_Client.discover">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>69</td><td><code><pre>func (c *Client) discover() error {</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        if c.discoveryInterval == 0 {</pre></code></td></tr><tr><td>71</td><td><code><pre>                //common.Log.Debugf(&#34;Discovery interval is zero, discovery will only be performed once&#34;)</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                return c.protocol.Discover()</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        go func() {</pre></code></td></tr><tr><td>76</td><td><code><pre>                c.RLock()</pre></code></td></tr><tr><td>77</td><td><code><pre>                tick := time.Tick(c.discoveryInterval)</pre></code></td></tr><tr><td>78</td><td><code><pre>                c.RUnlock()</pre></code></td></tr><tr><td>79</td><td><code><pre>                for {</pre></code></td></tr><tr><td>80</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>81</td><td><code><pre>                        case &lt;-c.quitChan:</pre></code></td></tr><tr><td>82</td><td><code><pre>                                //common.Log.Debugf(&#34;Quitting discoveryfile loop&#34;)</pre></code></td></tr><tr><td>83</td><td><code><pre>                                return</pre></code></td></tr><tr><td>84</td><td><code><pre>                        default:</pre></code></td></tr><tr><td>85</td><td><code><pre>                        }</pre></code></td></tr><tr><td>86</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>87</td><td><code><pre>                        case &lt;-c.quitChan:</pre></code></td></tr><tr><td>88</td><td><code><pre>                                //common.Log.Debugf(&#34;Quitting discovery loop&#34;)</pre></code></td></tr><tr><td>89</td><td><code><pre>                                return</pre></code></td></tr><tr><td>90</td><td><code><pre>                        case &lt;-tick:</pre></code></td></tr><tr><td>91</td><td><code><pre>                                //common.Log.Debugf(&#34;Performing discovery&#34;)</pre></code></td></tr><tr><td>92</td><td><code><pre>                                _ = c.protocol.Discover()</pre></code></td></tr><tr><td>93</td><td><code><pre>                        }</pre></code></td></tr><tr><td>94</td><td><code><pre>                }</pre></code></td></tr><tr><td>95</td><td><code><pre>        }()</pre></code></td></tr><tr><td>96</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>98</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.init">func Client.init</div><div class="info"><a href="#s_fn_Client.init">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>55</td><td><code><pre>func (c *Client) init() error {</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>        if err := c.subscribe(); err != nil {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>                return err</pre></code></td></tr><tr><td>58</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>        return c.discover()</pre></code></td></tr><tr><td>60</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.SetDiscoveryInterval">func Client.SetDiscoveryInterval</div><div class="info"><a href="#s_fn_Client.SetDiscoveryInterval">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func (c *Client) SetDiscoveryInterval(interval time.Duration) error {</pre></code></td></tr><tr><td>63</td><td><code><pre>        // TODO Clean up existing discovery goroutines.</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>        c.discoveryInterval = interval</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>        c.protocol.SetExpiryTime(interval * 3)</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        return c.discover()</pre></code></td></tr><tr><td>67</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@107:5">func @107:5</div><div class="info"><a href="#s_fn_@107:5">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>107</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                for event := range sub.Events() {</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                        c.Publish(event)</pre></code></td></tr><tr><td>110</td><td><code><pre>                }</pre></code></td></tr><tr><td>111</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@31:22">func @31:22</div><div class="info"><a href="#s_fn_@31:22">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func(crypto packet.Crypto, address net.Addr, requestSocket socket.UDPConn) packet.Transport {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                return packet.NewTransport(3, crypto, address, requestSocket, clk)</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@34:19">func @34:19</div><div class="info"><a href="#s_fn_@34:19">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>34</td><td><code><pre>func(deviceId uint32, transport packet.Transport, seen time.Time) device.Device {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                return device.New(deviceId, transport, seen)</pre></code></td></tr><tr><td>36</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@37:19">func @37:19</div><div class="info"><a href="#s_fn_@37:19">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/client.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func(deviceID uint32, deviceToken []byte, initialStamp uint32, stampTime time.Time) (packet.Crypto, error) {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                return packet.NewCrypto(deviceID, deviceToken, initialStamp, stampTime, clk)</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go DONE:0.00
-->

<div id="pkg_github.com/nickw444/miio-go/capability" class="funcname">Package Overview: github.com/nickw444/miio-go/capability <span class="packageTotal">100.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/capability</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/capability | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_Power.Update"><td><code><a href="#fn_Power.Update">Power.Update(...)</a></code></td><td><code>github.com/nickw444/miio-go/capability/power.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>8/8</code></td></tr>
<tr id="s_fn_Power.SetPower"><td><code><a href="#fn_Power.SetPower">Power.SetPower(...)</a></code></td><td><code>github.com/nickw444/miio-go/capability/power.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>6/6</code></td></tr>
<tr id="s_fn_NewPower"><td><code><a href="#fn_NewPower">NewPower(...)</a></code></td><td><code>github.com/nickw444/miio-go/capability/power.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/capability</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>15/15</code></td></tr>
</table>

<div class="funcname" id="fn_Power.Update">func Power.Update</div><div class="info"><a href="#s_fn_Power.Update">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/capability/power.go</code>:</p></div><table class="listing">
<tr><td>40</td><td><code><pre>func (p *Power) Update() error {</pre></code></td></tr><tr><td>41</td><td><code><pre>        resp := PowerResponse{}</pre></code></td></tr><tr><td>42</td><td><code><pre>        err := p.transport.CallAndDeserialize(&#34;get_prop&#34;, []string{&#34;power&#34;}, &amp;resp)</pre></code></td></tr><tr><td>43</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr><td>44</td><td><code><pre>                return err</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr><td>46</td><td><code><pre></pre></code></td></tr><tr><td>47</td><td><code><pre>        if resp.Result[0] != p.powerState {</pre></code></td></tr><tr><td>48</td><td><code><pre>                p.powerState = resp.Result[0]</pre></code></td></tr><tr><td>49</td><td><code><pre>                p.subscriptionTarget.Publish(common.EventUpdatePower{p.powerState})</pre></code></td></tr><tr><td>50</td><td><code><pre>        }</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr><td>52</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>53</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Power.SetPower">func Power.SetPower</div><div class="info"><a href="#s_fn_Power.SetPower">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/capability/power.go</code>:</p></div><table class="listing">
<tr><td>27</td><td><code><pre>func (p *Power) SetPower(state common.PowerState) error {</pre></code></td></tr><tr><td>28</td><td><code><pre>        _, err := p.transport.Call(&#34;set_power&#34;, []string{string(state)})</pre></code></td></tr><tr><td>29</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr><td>30</td><td><code><pre>                return err</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr><tr><td>32</td><td><code><pre></pre></code></td></tr><tr><td>33</td><td><code><pre>        // TODO NW: Use the value from the response here.</pre></code></td></tr><tr><td>34</td><td><code><pre>        p.powerState = state</pre></code></td></tr><tr><td>35</td><td><code><pre>        p.subscriptionTarget.Publish(common.EventUpdatePower{p.powerState})</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr><td>37</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewPower">func NewPower</div><div class="info"><a href="#s_fn_NewPower">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/capability/power.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func NewPower(target subscription.SubscriptionTarget, transport packet.Transport) *Power {</pre></code></td></tr><tr><td>20</td><td><code><pre>        return &amp;Power{</pre></code></td></tr><tr><td>21</td><td><code><pre>                subscriptionTarget: target,</pre></code></td></tr><tr><td>22</td><td><code><pre>                transport:          transport,</pre></code></td></tr><tr><td>23</td><td><code><pre>                powerState:         common.PowerStateUnknown,</pre></code></td></tr><tr><td>24</td><td><code><pre>        }</pre></code></td></tr><tr><td>25</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/capability DONE:100.00
-->

<div id="pkg_github.com/nickw444/miio-go/device" class="funcname">Package Overview: github.com/nickw444/miio-go/device <span class="packageTotal">73.24%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/device</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/device | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_refreshThrottle.Start"><td><code><a href="#fn_refreshThrottle.Start">refreshThrottle.Start(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_baseDevice.CloseSubscription"><td><code><a href="#fn_baseDevice.CloseSubscription">baseDevice.CloseSubscription(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_refreshThrottle.Stop"><td><code><a href="#fn_refreshThrottle.Stop">refreshThrottle.Stop(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_baseDevice.Handle"><td><code><a href="#fn_baseDevice.Handle">baseDevice.Handle(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_baseDevice.Close"><td><code><a href="#fn_baseDevice.Close">baseDevice.Close(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_NewPowerPlug"><td><code><a href="#fn_NewPowerPlug">NewPowerPlug(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/powerplug.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_baseDevice.NewSubscription"><td><code><a href="#fn_baseDevice.NewSubscription">baseDevice.NewSubscription(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_refreshThrottle.Close"><td><code><a href="#fn_refreshThrottle.Close">refreshThrottle.Close(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_baseDevice.init"><td><code><a href="#fn_baseDevice.init">baseDevice.init(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_refreshThrottle.Chan"><td><code><a href="#fn_refreshThrottle.Chan">refreshThrottle.Chan(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_baseDevice.SetProvisional"><td><code><a href="#fn_baseDevice.SetProvisional">baseDevice.SetProvisional(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_baseDevice.Discover"><td><code><a href="#fn_baseDevice.Discover">baseDevice.Discover(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_NewYeelight"><td><code><a href="#fn_NewYeelight">NewYeelight(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/yeelight.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Classify"><td><code><a href="#fn_Classify">Classify(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/classification.go</code></td><td class="percent"><code>90.00%</code></td><td class="linecount"><code>9/10</code></td></tr>
<tr id="s_fn_refreshThrottle.refresh"><td><code><a href="#fn_refreshThrottle.refresh">refreshThrottle.refresh(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>83.33%</code></td><td class="linecount"><code>5/6</code></td></tr>
<tr id="s_fn_baseDevice.GetProduct"><td><code><a href="#fn_baseDevice.GetProduct">baseDevice.GetProduct(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_PowerPlug.refresh"><td><code><a href="#fn_PowerPlug.refresh">PowerPlug.refresh(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/powerplug.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>1/3</code></td></tr>
<tr id="s_fn_New"><td><code><a href="#fn_New">New(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_NewRefreshThrottle"><td><code><a href="#fn_NewRefreshThrottle">NewRefreshThrottle(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_baseDevice.RefreshThrottle"><td><code><a href="#fn_baseDevice.RefreshThrottle">baseDevice.RefreshThrottle(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@28:18"><td><code><a href="#fn_@28:18">@28:18(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/refresh_throttle.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_baseDevice.Transport"><td><code><a href="#fn_baseDevice.Transport">baseDevice.Transport(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_baseDevice.Provisional"><td><code><a href="#fn_baseDevice.Provisional">baseDevice.Provisional(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_baseDevice.Seen"><td><code><a href="#fn_baseDevice.Seen">baseDevice.Seen(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_baseDevice.GetLabel"><td><code><a href="#fn_baseDevice.GetLabel">baseDevice.GetLabel(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_baseDevice.ID"><td><code><a href="#fn_baseDevice.ID">baseDevice.ID(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/basedevice.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Yeelight.SetPower"><td><code><a href="#fn_Yeelight.SetPower">Yeelight.SetPower(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/yeelight.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/device</code></td><td class="percent"><code>73.24%</code></td><td class="linecount"><code>52/71</code></td></tr>
</table>

<div class="funcname" id="fn_refreshThrottle.Start">func refreshThrottle.Start</div><div class="info"><a href="#s_fn_refreshThrottle.Start">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func (r *refreshThrottle) Start() {</pre></code></td></tr><tr><td>38</td><td><code><pre>        if r.ticker == nil {</pre></code></td></tr><tr><td>39</td><td><code><pre>                r.quitChan = make(chan struct{})</pre></code></td></tr><tr><td>40</td><td><code><pre>                r.ticker = r.tickerFactory()</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr><td>42</td><td><code><pre>                // Request a refresh immediately.</pre></code></td></tr><tr><td>43</td><td><code><pre>                r.ch &lt;- struct{}{}</pre></code></td></tr><tr><td>44</td><td><code><pre>                go r.refresh()</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr><td>46</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.CloseSubscription">func baseDevice.CloseSubscription</div><div class="info"><a href="#s_fn_baseDevice.CloseSubscription">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>108</td><td><code><pre>func (b *baseDevice) CloseSubscription(s *subscription.Subscription) (err error) {</pre></code></td></tr><tr><td>109</td><td><code><pre>        err = b.SubscriptionTarget.CloseSubscription(s)</pre></code></td></tr><tr><td>110</td><td><code><pre>        if !b.HasSubscribers() {</pre></code></td></tr><tr><td>111</td><td><code><pre>                b.refreshThrottle.Stop()</pre></code></td></tr><tr><td>112</td><td><code><pre>        }</pre></code></td></tr><tr><td>113</td><td><code><pre>        return</pre></code></td></tr><tr><td>114</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_refreshThrottle.Stop">func refreshThrottle.Stop</div><div class="info"><a href="#s_fn_refreshThrottle.Stop">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (r *refreshThrottle) Stop() {</pre></code></td></tr><tr><td>49</td><td><code><pre>        if r.ticker != nil {</pre></code></td></tr><tr><td>50</td><td><code><pre>                r.ticker.Stop()</pre></code></td></tr><tr><td>51</td><td><code><pre>                r.ticker = nil</pre></code></td></tr><tr><td>52</td><td><code><pre>                close(r.quitChan)</pre></code></td></tr><tr><td>53</td><td><code><pre>        }</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Handle">func baseDevice.Handle</div><div class="info"><a href="#s_fn_baseDevice.Handle">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>64</td><td><code><pre>func (b *baseDevice) Handle(pkt *packet.Packet) error {</pre></code></td></tr><tr><td>65</td><td><code><pre>        common.Log.Infof(&#34;Handling packet at base_device&#34;)</pre></code></td></tr><tr><td>66</td><td><code><pre>        b.seen = pkt.Meta.DecodeTime</pre></code></td></tr><tr><td>67</td><td><code><pre>        return b.transport.Handle(pkt)</pre></code></td></tr><tr><td>68</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Close">func baseDevice.Close</div><div class="info"><a href="#s_fn_baseDevice.Close">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>70</td><td><code><pre>func (b *baseDevice) Close() error {</pre></code></td></tr><tr><td>71</td><td><code><pre>        err := b.SubscriptionTarget.CloseAllSubscriptions()</pre></code></td></tr><tr><td>72</td><td><code><pre>        b.refreshThrottle.Close()</pre></code></td></tr><tr><td>73</td><td><code><pre>        return err</pre></code></td></tr><tr><td>74</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewPowerPlug">func NewPowerPlug</div><div class="info"><a href="#s_fn_NewPowerPlug">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/powerplug.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func NewPowerPlug(device Device) *PowerPlug {</pre></code></td></tr><tr><td>14</td><td><code><pre>        dev := &amp;PowerPlug{</pre></code></td></tr><tr><td>15</td><td><code><pre>                Device: device,</pre></code></td></tr><tr><td>16</td><td><code><pre>                power:  capability.NewPower(device, device.Transport()),</pre></code></td></tr><tr><td>17</td><td><code><pre>        }</pre></code></td></tr><tr><td>18</td><td><code><pre>        go dev.refresh()</pre></code></td></tr><tr><td>19</td><td><code><pre>        return dev</pre></code></td></tr><tr><td>20</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.NewSubscription">func baseDevice.NewSubscription</div><div class="info"><a href="#s_fn_baseDevice.NewSubscription">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>102</td><td><code><pre>func (b *baseDevice) NewSubscription() (*subscription.Subscription, error) {</pre></code></td></tr><tr><td>103</td><td><code><pre>        sub, err := b.SubscriptionTarget.NewSubscription()</pre></code></td></tr><tr><td>104</td><td><code><pre>        b.refreshThrottle.Start()</pre></code></td></tr><tr><td>105</td><td><code><pre>        return sub, err</pre></code></td></tr><tr><td>106</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_refreshThrottle.Close">func refreshThrottle.Close</div><div class="info"><a href="#s_fn_refreshThrottle.Close">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func (r *refreshThrottle) Close() {</pre></code></td></tr><tr><td>57</td><td><code><pre>        r.Stop()</pre></code></td></tr><tr><td>58</td><td><code><pre>        close(r.ch)</pre></code></td></tr><tr><td>59</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.init">func baseDevice.init</div><div class="info"><a href="#s_fn_baseDevice.init">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>51</td><td><code><pre>func (b *baseDevice) init() {</pre></code></td></tr><tr><td>52</td><td><code><pre>        b.product = product.Unknown</pre></code></td></tr><tr><td>53</td><td><code><pre>        b.provisional = true</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_refreshThrottle.Chan">func refreshThrottle.Chan</div><div class="info"><a href="#s_fn_refreshThrottle.Chan">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>33</td><td><code><pre>func (r *refreshThrottle) Chan() &lt;-chan struct{} {</pre></code></td></tr><tr><td>34</td><td><code><pre>        return r.ch</pre></code></td></tr><tr><td>35</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.SetProvisional">func baseDevice.SetProvisional</div><div class="info"><a href="#s_fn_baseDevice.SetProvisional">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>84</td><td><code><pre>func (b *baseDevice) SetProvisional(provisional bool) {</pre></code></td></tr><tr><td>85</td><td><code><pre>        b.provisional = provisional</pre></code></td></tr><tr><td>86</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Discover">func baseDevice.Discover</div><div class="info"><a href="#s_fn_baseDevice.Discover">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>98</td><td><code><pre>func (b *baseDevice) Discover() error {</pre></code></td></tr><tr><td>99</td><td><code><pre>        return b.transport.Send(packet.NewHello())</pre></code></td></tr><tr><td>100</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewYeelight">func NewYeelight</div><div class="info"><a href="#s_fn_NewYeelight">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/yeelight.go</code>:</p></div><table class="listing">
<tr><td>7</td><td><code><pre>func NewYeelight(device Device) *Yeelight {</pre></code></td></tr><tr><td>8</td><td><code><pre>        return &amp;Yeelight{</pre></code></td></tr><tr><td>9</td><td><code><pre>                Device: device,</pre></code></td></tr><tr><td>10</td><td><code><pre>        }</pre></code></td></tr><tr><td>11</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Classify">func Classify</div><div class="info"><a href="#s_fn_Classify">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/classification.go</code>:</p></div><table class="listing">
<tr><td>11</td><td><code><pre>func Classify(dev Device) (Device, error) {</pre></code></td></tr><tr><td>12</td><td><code><pre>        if !dev.Provisional() {</pre></code></td></tr><tr><td>13</td><td><code><pre>                return dev, nil</pre></code></td></tr><tr><td>14</td><td><code><pre>        }</pre></code></td></tr><tr><td>15</td><td><code><pre></pre></code></td></tr><tr><td>16</td><td><code><pre>        p, err := dev.GetProduct()</pre></code></td></tr><tr><td>17</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>19</td><td><code><pre>        }</pre></code></td></tr><tr><td>20</td><td><code><pre></pre></code></td></tr><tr><td>21</td><td><code><pre>        defer dev.SetProvisional(false)</pre></code></td></tr><tr><td>22</td><td><code><pre></pre></code></td></tr><tr><td>23</td><td><code><pre>        switch p {</pre></code></td></tr><tr><td>24</td><td><code><pre>        case product.Yeelight:</pre></code></td></tr><tr><td>25</td><td><code><pre>                return NewYeelight(dev), nil</pre></code></td></tr><tr><td>26</td><td><code><pre>        case product.PowerPlug:</pre></code></td></tr><tr><td>27</td><td><code><pre>                return NewPowerPlug(dev), nil</pre></code></td></tr><tr><td>28</td><td><code><pre>        default:</pre></code></td></tr><tr><td>29</td><td><code><pre>                return nil, fmt.Errorf(&#34;Classify: Unknown device type&#34;)</pre></code></td></tr><tr><td>30</td><td><code><pre>        }</pre></code></td></tr><tr><td>31</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_refreshThrottle.refresh">func refreshThrottle.refresh</div><div class="info"><a href="#s_fn_refreshThrottle.refresh">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>61</td><td><code><pre>func (r *refreshThrottle) refresh() {</pre></code></td></tr><tr><td>62</td><td><code><pre>        for {</pre></code></td></tr><tr><td>63</td><td><code><pre>                select {</pre></code></td></tr><tr><td>64</td><td><code><pre>                case &lt;-r.quitChan:</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                        return</pre></code></td></tr><tr><td>66</td><td><code><pre>                default:</pre></code></td></tr><tr><td>67</td><td><code><pre>                }</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr><td>69</td><td><code><pre>                select {</pre></code></td></tr><tr><td>70</td><td><code><pre>                case &lt;-r.quitChan:</pre></code></td></tr><tr><td>71</td><td><code><pre>                        return</pre></code></td></tr><tr><td>72</td><td><code><pre>                case &lt;-r.ticker.C:</pre></code></td></tr><tr><td>73</td><td><code><pre>                        r.ch &lt;- struct{}{}</pre></code></td></tr><tr><td>74</td><td><code><pre>                }</pre></code></td></tr><tr><td>75</td><td><code><pre>        }</pre></code></td></tr><tr><td>76</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.GetProduct">func baseDevice.GetProduct</div><div class="info"><a href="#s_fn_baseDevice.GetProduct">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>88</td><td><code><pre>func (b *baseDevice) GetProduct() (product.Product, error) {</pre></code></td></tr><tr><td>89</td><td><code><pre>        resp := InfoResponse{}</pre></code></td></tr><tr><td>90</td><td><code><pre>        err := b.transport.CallAndDeserialize(&#34;miIO.info&#34;, nil, &amp;resp)</pre></code></td></tr><tr><td>91</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                return product.Unknown, err</pre></code></td></tr><tr><td>93</td><td><code><pre>        }</pre></code></td></tr><tr><td>94</td><td><code><pre></pre></code></td></tr><tr><td>95</td><td><code><pre>        return product.GetModel(resp.Result.Model)</pre></code></td></tr><tr><td>96</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_PowerPlug.refresh">func PowerPlug.refresh</div><div class="info"><a href="#s_fn_PowerPlug.refresh">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/powerplug.go</code>:</p></div><table class="listing">
<tr><td>22</td><td><code><pre>func (p *PowerPlug) refresh() {</pre></code></td></tr><tr><td>23</td><td><code><pre>        for range p.RefreshThrottle() {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>                _ = p.power.Update()</pre></code></td></tr><tr><td>25</td><td><code><pre>        }</pre></code></td></tr><tr><td>26</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        common.Log.Debug(&#34;Device refresh closed.&#34;)</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_New">func New</div><div class="info"><a href="#s_fn_New">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func New(deviceId uint32, transport packet.Transport, seen time.Time) Device {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>        throttle := NewRefreshThrottle(time.Second * 5)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        b := &amp;baseDevice{</pre></code></td></tr><tr><td>40</td><td><code><pre>                SubscriptionTarget: subscription.NewTarget(),</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr><td>42</td><td><code><pre>                refreshThrottle: throttle,</pre></code></td></tr><tr><td>43</td><td><code><pre>                transport:       transport,</pre></code></td></tr><tr><td>44</td><td><code><pre>                id:              deviceId,</pre></code></td></tr><tr><td>45</td><td><code><pre>                seen:            seen,</pre></code></td></tr><tr><td>46</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        b.init()</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        return b</pre></code></td></tr><tr><td>49</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewRefreshThrottle">func NewRefreshThrottle</div><div class="info"><a href="#s_fn_NewRefreshThrottle">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr><td>25</td><td><code><pre>func NewRefreshThrottle(refreshInterval time.Duration) RefreshThrottle {</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        c := clock.New()</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        return &amp;refreshThrottle{</pre></code></td></tr><tr><td>28</td><td><code><pre>                tickerFactory: func() *clock.Ticker { return c.Ticker(refreshInterval) },</pre></code></td></tr><tr><td>29</td><td><code><pre>                ch:            make(chan struct{}),</pre></code></td></tr><tr><td>30</td><td><code><pre>        }</pre></code></td></tr><tr><td>31</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.RefreshThrottle">func baseDevice.RefreshThrottle</div><div class="info"><a href="#s_fn_baseDevice.RefreshThrottle">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>116</td><td><code><pre>func (b *baseDevice) RefreshThrottle() &lt;-chan struct{} {</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        return b.refreshThrottle.Chan()</pre></code></td></tr><tr><td>118</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@28:18">func @28:18</div><div class="info"><a href="#s_fn_@28:18">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/refresh_throttle.go</code>:</p></div><table class="listing">
<tr class="miss"><td>28</td><td><code><pre>func() *clock.Ticker { return c.Ticker(refreshInterval) }</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Transport">func baseDevice.Transport</div><div class="info"><a href="#s_fn_baseDevice.Transport">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>120</td><td><code><pre>func (b *baseDevice) Transport() packet.Transport {</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        return b.transport</pre></code></td></tr><tr><td>122</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Provisional">func baseDevice.Provisional</div><div class="info"><a href="#s_fn_baseDevice.Provisional">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>80</td><td><code><pre>func (b *baseDevice) Provisional() bool {</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        return b.provisional</pre></code></td></tr><tr><td>82</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.Seen">func baseDevice.Seen</div><div class="info"><a href="#s_fn_baseDevice.Seen">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>76</td><td><code><pre>func (b *baseDevice) Seen() time.Time {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>        return b.seen</pre></code></td></tr><tr><td>78</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.GetLabel">func baseDevice.GetLabel</div><div class="info"><a href="#s_fn_baseDevice.GetLabel">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>60</td><td><code><pre>func (b *baseDevice) GetLabel() (string, error) {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        return &#34;&#34;, nil</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_baseDevice.ID">func baseDevice.ID</div><div class="info"><a href="#s_fn_baseDevice.ID">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/basedevice.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func (b *baseDevice) ID() uint32 {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        return b.id</pre></code></td></tr><tr><td>58</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Yeelight.SetPower">func Yeelight.SetPower</div><div class="info"><a href="#s_fn_Yeelight.SetPower">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/yeelight.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func (p *Yeelight) SetPower(power bool) error {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>15</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/device DONE:73.24
-->

<div id="pkg_github.com/nickw444/miio-go/device/product" class="funcname">Package Overview: github.com/nickw444/miio-go/device/product <span class="packageTotal">100.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/device/product</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/device/product | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_GetModel"><td><code><a href="#fn_GetModel">GetModel(...)</a></code></td><td><code>github.com/nickw444/miio-go/device/product/product.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/device/product</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
</table>

<div class="funcname" id="fn_GetModel">func GetModel</div><div class="info"><a href="#s_fn_GetModel">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/device/product/product.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func GetModel(modelName string) (Product, error) {</pre></code></td></tr><tr><td>14</td><td><code><pre>        switch modelName {</pre></code></td></tr><tr><td>15</td><td><code><pre>        case &#34;chuangmi.plug.m1&#34;:</pre></code></td></tr><tr><td>16</td><td><code><pre>                return PowerPlug, nil</pre></code></td></tr><tr><td>17</td><td><code><pre>        default:</pre></code></td></tr><tr><td>18</td><td><code><pre>                return Unknown, fmt.Errorf(&#34;Unknown product for device type %s&#34;, modelName)</pre></code></td></tr><tr><td>19</td><td><code><pre>        }</pre></code></td></tr><tr><td>20</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/device/product DONE:100.00
-->

<div id="pkg_github.com/nickw444/miio-go/protocol" class="funcname">Package Overview: github.com/nickw444/miio-go/protocol <span class="packageTotal">0.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/protocol</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/protocol | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_protocol.Discover"><td><code><a href="#fn_protocol.Discover">protocol.Discover(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/21</code></td></tr>
<tr id="s_fn_protocol.process"><td><code><a href="#fn_protocol.process">protocol.process(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/19</code></td></tr>
<tr id="s_fn_NewProtocol"><td><code><a href="#fn_NewProtocol">NewProtocol(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_protocol.dispatcher"><td><code><a href="#fn_protocol.dispatcher">protocol.dispatcher(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_protocol.getDevice"><td><code><a href="#fn_protocol.getDevice">protocol.getDevice(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_protocol.removeDevice"><td><code><a href="#fn_protocol.removeDevice">protocol.removeDevice(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_protocol.addDevice"><td><code><a href="#fn_protocol.addDevice">protocol.addDevice(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_protocol.SetExpiryTime"><td><code><a href="#fn_protocol.SetExpiryTime">protocol.SetExpiryTime(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/protocol.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/protocol</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/83</code></td></tr>
</table>

<div class="funcname" id="fn_protocol.Discover">func protocol.Discover</div><div class="info"><a href="#s_fn_protocol.Discover">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>118</td><td><code><pre>func (p *protocol) Discover() error {</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        common.Log.Debug(&#34;Running discovery...&#34;)</pre></code></td></tr><tr><td>120</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        if p.lastDiscovery.After(time.Time{}) {</pre></code></td></tr><tr><td>122</td><td><code><pre>                // If the device has not been seen recently, it should be expired.</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                cutoff := time.Now().Add(p.expireAfter * -1)</pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>                var expiredDevices []device.Device</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>                p.devicesMutex.RLock()</pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>                for _, dev := range p.devices {</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                        if dev.Seen().Before(cutoff) {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>                                common.Log.Infof(&#34;Last Seen: %s, Cutoff: %s&#34;, dev.Seen(), cutoff)</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>                                expiredDevices = append(expiredDevices, dev)</pre></code></td></tr><tr><td>130</td><td><code><pre>                        }</pre></code></td></tr><tr><td>131</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>                p.devicesMutex.RUnlock()</pre></code></td></tr><tr><td>133</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>                for _, dev := range expiredDevices {</pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>                        common.Log.Debugf(&#34;Removing expired device with id %d.&#34;, dev.ID())</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>                        p.removeDevice(dev.ID())</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>                        dev.Close()</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>                        err := p.Publish(common.EventExpiredDevice{dev})</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                                common.Log.Warn(err)</pre></code></td></tr><tr><td>141</td><td><code><pre>                        }</pre></code></td></tr><tr><td>142</td><td><code><pre>                }</pre></code></td></tr><tr><td>143</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>        if err := p.broadcastDev.Discover(); err != nil {</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>                return err</pre></code></td></tr><tr><td>146</td><td><code><pre>        }</pre></code></td></tr><tr><td>147</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>        p.lastDiscovery = time.Now()</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>150</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.process">func protocol.process</div><div class="info"><a href="#s_fn_protocol.process">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>151</td><td><code><pre>func (p *protocol) process(pkt *packet.Packet, addr *net.UDPAddr) {</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        common.Log.Debugf(&#34;Processing incoming packet from %s&#34;, addr)</pre></code></td></tr><tr><td>153</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>        dev := p.getDevice(pkt.Header.DeviceID)</pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>        if dev == nil &amp;&amp; pkt.DataLength() == 0 {</pre></code></td></tr><tr><td>156</td><td><code><pre></pre></code></td></tr><tr><td>157</td><td><code><pre>                // Device response to a Hello packet.</pre></code></td></tr><tr class="miss"><td>158</td><td><code><pre>                crypto, err := p.cryptoFactory(pkt.Header.DeviceID, pkt.Header.Checksum, pkt.Header.Stamp,</pre></code></td></tr><tr><td>159</td><td><code><pre>                        pkt.Meta.DecodeTime)</pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>                        panic(err)</pre></code></td></tr><tr><td>162</td><td><code><pre>                }</pre></code></td></tr><tr><td>163</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                transport := p.transportFactory(crypto, addr, p.socket)</pre></code></td></tr><tr class="miss"><td>165</td><td><code><pre>                baseDev := p.deviceFactory(pkt.Header.DeviceID, transport, pkt.Meta.DecodeTime)</pre></code></td></tr><tr><td>166</td><td><code><pre></pre></code></td></tr><tr><td>167</td><td><code><pre>                // Store the provisional device for now to ensure it can handle subsequent</pre></code></td></tr><tr><td>168</td><td><code><pre>                // packets that may occur during classification.</pre></code></td></tr><tr class="miss"><td>169</td><td><code><pre>                p.addDevice(baseDev)</pre></code></td></tr><tr><td>170</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>                dev, err := device.Classify(baseDev)</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>                        panic(err)</pre></code></td></tr><tr><td>174</td><td><code><pre>                }</pre></code></td></tr><tr><td>175</td><td><code><pre></pre></code></td></tr><tr><td>176</td><td><code><pre>                // Store the specific device and publish a new device event.</pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>                p.addDevice(dev)</pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>                p.Publish(common.EventNewDevice{Device: dev})</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        } else if dev != nil {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                err := dev.Handle(pkt)</pre></code></td></tr><tr class="miss"><td>181</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>182</td><td><code><pre>                        panic(err)</pre></code></td></tr><tr><td>183</td><td><code><pre>                }</pre></code></td></tr><tr><td>184</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>                panic(fmt.Errorf(&#34;Unable to process packet.&#34;))</pre></code></td></tr><tr><td>186</td><td><code><pre>        }</pre></code></td></tr><tr><td>187</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewProtocol">func NewProtocol</div><div class="info"><a href="#s_fn_NewProtocol">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func NewProtocol(c clock.Clock, transportFactory TransportFactory, deviceFactory DeviceFactory,</pre></code></td></tr><tr><td>47</td><td><code><pre>        crptoFactory CryptoFactory) (Protocol, error) {</pre></code></td></tr><tr><td>48</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        p := &amp;protocol{</pre></code></td></tr><tr><td>50</td><td><code><pre>                SubscriptionTarget: subscription.NewTarget(),</pre></code></td></tr><tr><td>51</td><td><code><pre>                transportFactory:   transportFactory,</pre></code></td></tr><tr><td>52</td><td><code><pre>                deviceFactory:      deviceFactory,</pre></code></td></tr><tr><td>53</td><td><code><pre>                cryptoFactory:      crptoFactory,</pre></code></td></tr><tr><td>54</td><td><code><pre>                clock:              c,</pre></code></td></tr><tr><td>55</td><td><code><pre>        }</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        var listenAddr *net.UDPAddr</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        if p.port != 0 {</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                listenAddr = &amp;net.UDPAddr{Port: p.port}</pre></code></td></tr><tr><td>60</td><td><code><pre>        }</pre></code></td></tr><tr><td>61</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>62</td><td><code><pre>        s, err := net.ListenUDP(&#34;udp&#34;, listenAddr)</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>65</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        p.socket = s</pre></code></td></tr><tr><td>67</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        addr := &amp;net.UDPAddr{</pre></code></td></tr><tr><td>69</td><td><code><pre>                IP:   net.IPv4(255, 255, 255, 255),</pre></code></td></tr><tr><td>70</td><td><code><pre>                Port: 54321,</pre></code></td></tr><tr><td>71</td><td><code><pre>        }</pre></code></td></tr><tr><td>72</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>        transport := transportFactory(nil, addr, p.socket)</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>        p.broadcastDev = deviceFactory(0, transport, time.Time{})</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        p.quitChan = make(chan struct{})</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>        p.devices = make(map[uint32]device.Device)</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>        go p.dispatcher()</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        return p, nil</pre></code></td></tr><tr><td>81</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.dispatcher">func protocol.dispatcher</div><div class="info"><a href="#s_fn_protocol.dispatcher">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>87</td><td><code><pre>func (p *protocol) dispatcher() {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>                select {</pre></code></td></tr><tr><td>90</td><td><code><pre>                case &lt;-p.quitChan:</pre></code></td></tr><tr><td>91</td><td><code><pre>                        // Cleanup.</pre></code></td></tr><tr><td>92</td><td><code><pre>                        // TODO: Close all devices.</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                        if err := p.socket.Close(); err != nil {</pre></code></td></tr><tr><td>94</td><td><code><pre>                                // TODO: Log error</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>                                panic(err)</pre></code></td></tr><tr><td>96</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>                        return</pre></code></td></tr><tr><td>98</td><td><code><pre>                default:</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>                        buf := make([]byte, 1024)</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>                        n, addr, err := p.socket.ReadFromUDP(buf)</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                                panic(err)</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>104</td><td><code><pre>                        }</pre></code></td></tr><tr><td>105</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>                        pkt, err := packet.Decode(buf[:n])</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                                panic(err)</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>110</td><td><code><pre>                        }</pre></code></td></tr><tr><td>111</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>                        go p.process(pkt, addr)</pre></code></td></tr><tr><td>113</td><td><code><pre>                }</pre></code></td></tr><tr><td>114</td><td><code><pre></pre></code></td></tr><tr><td>115</td><td><code><pre>        }</pre></code></td></tr><tr><td>116</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.getDevice">func protocol.getDevice</div><div class="info"><a href="#s_fn_protocol.getDevice">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>201</td><td><code><pre>func (p *protocol) getDevice(id uint32) device.Device {</pre></code></td></tr><tr class="miss"><td>202</td><td><code><pre>        p.devicesMutex.RLock()</pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>        dev, ok := p.devices[id]</pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>        p.devicesMutex.RUnlock()</pre></code></td></tr><tr class="miss"><td>205</td><td><code><pre>        if !ok {</pre></code></td></tr><tr class="miss"><td>206</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>207</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>208</td><td><code><pre>        return dev</pre></code></td></tr><tr><td>209</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.removeDevice">func protocol.removeDevice</div><div class="info"><a href="#s_fn_protocol.removeDevice">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>189</td><td><code><pre>func (p *protocol) removeDevice(id uint32) {</pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>        p.devicesMutex.Lock()</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>        delete(p.devices, id)</pre></code></td></tr><tr class="miss"><td>192</td><td><code><pre>        p.devicesMutex.Unlock()</pre></code></td></tr><tr><td>193</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.addDevice">func protocol.addDevice</div><div class="info"><a href="#s_fn_protocol.addDevice">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>195</td><td><code><pre>func (p *protocol) addDevice(dev device.Device) {</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>        p.devicesMutex.Lock()</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>        p.devices[dev.ID()] = dev</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>        p.devicesMutex.Unlock()</pre></code></td></tr><tr><td>199</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_protocol.SetExpiryTime">func protocol.SetExpiryTime</div><div class="info"><a href="#s_fn_protocol.SetExpiryTime">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/protocol.go</code>:</p></div><table class="listing">
<tr><td>83</td><td><code><pre>func (p *protocol) SetExpiryTime(duration time.Duration) {</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>        p.expireAfter = duration</pre></code></td></tr><tr><td>85</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/protocol DONE:0.00
-->

<div id="pkg_github.com/nickw444/miio-go/protocol/packet" class="funcname">Package Overview: github.com/nickw444/miio-go/protocol/packet <span class="packageTotal">21.58%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/protocol/packet</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/protocol/packet | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_Decode"><td><code><a href="#fn_Decode">Decode(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_New"><td><code><a href="#fn_New">New(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_Packet.DataLength"><td><code><a href="#fn_Packet.DataLength">Packet.DataLength(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Packet.Verify"><td><code><a href="#fn_Packet.Verify">Packet.Verify(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>88.89%</code></td><td class="linecount"><code>8/9</code></td></tr>
<tr id="s_fn_Packet.Serialize"><td><code><a href="#fn_Packet.Serialize">Packet.Serialize(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>83.33%</code></td><td class="linecount"><code>5/6</code></td></tr>
<tr id="s_fn_Packet.WriteChecksum"><td><code><a href="#fn_Packet.WriteChecksum">Packet.WriteChecksum(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_Packet.CalcChecksum"><td><code><a href="#fn_Packet.CalcChecksum">Packet.CalcChecksum(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_transport.Handle"><td><code><a href="#fn_transport.Handle">transport.Handle(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/17</code></td></tr>
<tr id="s_fn_transport.Call"><td><code><a href="#fn_transport.Call">transport.Call(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_NewCrypto"><td><code><a href="#fn_NewCrypto">NewCrypto(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_transport.call"><td><code><a href="#fn_transport.call">transport.call(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_crypto.NewPacket"><td><code><a href="#fn_crypto.NewPacket">crypto.NewPacket(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_crypto.Encrypt"><td><code><a href="#fn_crypto.Encrypt">crypto.Encrypt(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_crypto.Decrypt"><td><code><a href="#fn_crypto.Decrypt">crypto.Decrypt(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_crypto.pkcs5Unpad"><td><code><a href="#fn_crypto.pkcs5Unpad">crypto.pkcs5Unpad(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_transport.CallAndDeserialize"><td><code><a href="#fn_transport.CallAndDeserialize">transport.CallAndDeserialize(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_crypto.pkcs5Pad"><td><code><a href="#fn_crypto.pkcs5Pad">crypto.pkcs5Pad(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_transport.Send"><td><code><a href="#fn_transport.Send">transport.Send(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_NewHello"><td><code><a href="#fn_NewHello">NewHello(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/packet.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_@115:8"><td><code><a href="#fn_@115:8">@115:8(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_NewTransport"><td><code><a href="#fn_NewTransport">NewTransport(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_crypto.VerifyPacket"><td><code><a href="#fn_crypto.VerifyPacket">crypto.VerifyPacket(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@108:8"><td><code><a href="#fn_@108:8">@108:8(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/transport.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_crypto.getStamp"><td><code><a href="#fn_crypto.getStamp">crypto.getStamp(...)</a></code></td><td><code>github.com/nickw444/miio-go/protocol/packet/crypto.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/protocol/packet</code></td><td class="percent"><code>21.58%</code></td><td class="linecount"><code>30/139</code></td></tr>
</table>

<div class="funcname" id="fn_Decode">func Decode</div><div class="info"><a href="#s_fn_Decode">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>88</td><td><code><pre>func Decode(data []byte) (*Packet, error) {</pre></code></td></tr><tr><td>89</td><td><code><pre>        meta := Meta{DecodeTime: time.Now()}</pre></code></td></tr><tr><td>90</td><td><code><pre>        header := Header{}</pre></code></td></tr><tr><td>91</td><td><code><pre>        struc.Unpack(bytes.NewBuffer(data[:32]), &amp;header)</pre></code></td></tr><tr><td>92</td><td><code><pre></pre></code></td></tr><tr><td>93</td><td><code><pre>        p := &amp;Packet{</pre></code></td></tr><tr><td>94</td><td><code><pre>                Meta:   meta,</pre></code></td></tr><tr><td>95</td><td><code><pre>                Header: header,</pre></code></td></tr><tr><td>96</td><td><code><pre>                Data:   data[32:],</pre></code></td></tr><tr><td>97</td><td><code><pre>        }</pre></code></td></tr><tr><td>98</td><td><code><pre>        return p, nil</pre></code></td></tr><tr><td>99</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_New">func New</div><div class="info"><a href="#s_fn_New">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>102</td><td><code><pre>func New(deviceId uint32, deviceToken []byte, stamp uint32, data []byte) *Packet {</pre></code></td></tr><tr><td>103</td><td><code><pre>        header := Header{</pre></code></td></tr><tr><td>104</td><td><code><pre>                Magic:    0x2131,</pre></code></td></tr><tr><td>105</td><td><code><pre>                Length:   uint16(32 + len(data)),</pre></code></td></tr><tr><td>106</td><td><code><pre>                F1:       0x0,</pre></code></td></tr><tr><td>107</td><td><code><pre>                DeviceID: deviceId,</pre></code></td></tr><tr><td>108</td><td><code><pre>                Stamp:    stamp,</pre></code></td></tr><tr><td>109</td><td><code><pre>                Checksum: deviceToken,</pre></code></td></tr><tr><td>110</td><td><code><pre>        }</pre></code></td></tr><tr><td>111</td><td><code><pre></pre></code></td></tr><tr><td>112</td><td><code><pre>        p := &amp;Packet{</pre></code></td></tr><tr><td>113</td><td><code><pre>                Header: header,</pre></code></td></tr><tr><td>114</td><td><code><pre>                Data:   data,</pre></code></td></tr><tr><td>115</td><td><code><pre>        }</pre></code></td></tr><tr><td>116</td><td><code><pre>        return p</pre></code></td></tr><tr><td>117</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Packet.DataLength">func Packet.DataLength</div><div class="info"><a href="#s_fn_Packet.DataLength">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>67</td><td><code><pre>func (p *Packet) DataLength() int {</pre></code></td></tr><tr><td>68</td><td><code><pre>        return len(p.Data)</pre></code></td></tr><tr><td>69</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Packet.Verify">func Packet.Verify</div><div class="info"><a href="#s_fn_Packet.Verify">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>71</td><td><code><pre>func (p *Packet) Verify(deviceToken []byte) error {</pre></code></td></tr><tr><td>72</td><td><code><pre>        var tmpPacket Packet</pre></code></td></tr><tr><td>73</td><td><code><pre>        tmpPacket = *p</pre></code></td></tr><tr><td>74</td><td><code><pre>        tmpPacket.Header.Checksum = deviceToken</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr><td>76</td><td><code><pre>        calculated, err := tmpPacket.CalcChecksum()</pre></code></td></tr><tr><td>77</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                return err</pre></code></td></tr><tr><td>79</td><td><code><pre>        }</pre></code></td></tr><tr><td>80</td><td><code><pre></pre></code></td></tr><tr><td>81</td><td><code><pre>        if !bytes.Equal(calculated, p.Header.Checksum) {</pre></code></td></tr><tr><td>82</td><td><code><pre>                return fmt.Errorf(&#34;Checksum could not be verified. Expected %s, got %s.&#34;,</pre></code></td></tr><tr><td>83</td><td><code><pre>                        hex.EncodeToString(calculated), hex.EncodeToString(p.Header.Checksum))</pre></code></td></tr><tr><td>84</td><td><code><pre>        }</pre></code></td></tr><tr><td>85</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>86</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Packet.Serialize">func Packet.Serialize</div><div class="info"><a href="#s_fn_Packet.Serialize">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (p *Packet) Serialize() []byte {</pre></code></td></tr><tr><td>37</td><td><code><pre>        var buf bytes.Buffer</pre></code></td></tr><tr><td>38</td><td><code><pre>        err := struc.Pack(&amp;buf, &amp;p.Header)</pre></code></td></tr><tr><td>39</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>41</td><td><code><pre>        }</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        buf.Write(p.Data)</pre></code></td></tr><tr><td>44</td><td><code><pre>        return buf.Bytes()</pre></code></td></tr><tr><td>45</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Packet.WriteChecksum">func Packet.WriteChecksum</div><div class="info"><a href="#s_fn_Packet.WriteChecksum">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>57</td><td><code><pre>func (p *Packet) WriteChecksum() error {</pre></code></td></tr><tr><td>58</td><td><code><pre>        checksum, err := p.CalcChecksum()</pre></code></td></tr><tr><td>59</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>                return err</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr><td>63</td><td><code><pre>        p.Header.Checksum = checksum</pre></code></td></tr><tr><td>64</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>65</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Packet.CalcChecksum">func Packet.CalcChecksum</div><div class="info"><a href="#s_fn_Packet.CalcChecksum">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>47</td><td><code><pre>func (p *Packet) CalcChecksum() ([]byte, error) {</pre></code></td></tr><tr><td>48</td><td><code><pre>        h := md5.New()</pre></code></td></tr><tr><td>49</td><td><code><pre>        _, err := h.Write(p.Serialize())</pre></code></td></tr><tr><td>50</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>52</td><td><code><pre>        }</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr><td>54</td><td><code><pre>        return h.Sum(nil), nil</pre></code></td></tr><tr><td>55</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_transport.Handle">func transport.Handle</div><div class="info"><a href="#s_fn_transport.Handle">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>65</td><td><code><pre>func (t *transport) Handle(pkt *Packet) error {</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        if pkt.Header.Length &lt;= 32 {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>68</td><td><code><pre>        }</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        err := t.crypto.VerifyPacket(pkt)</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        data, err := t.crypto.Decrypt(pkt.Data)</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        resp := response{}</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        err = json.Unmarshal(data, &amp;resp)</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                return err</pre></code></td></tr><tr><td>84</td><td><code><pre>        }</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr><td>86</td><td><code><pre>        // Lookup the response ID and pass data to the appropriate continuation goroutine.</pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>        if ch, ok := t.continuations[resp.ID]; ok {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>                common.Log.Debugf(&#34;Callback with ID %d was reconciled&#34;, resp.ID)</pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>                ch &lt;- data</pre></code></td></tr><tr><td>90</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>                common.Log.Debugf(&#34;Unable to reconcile callback for resp id %d&#34;, resp.ID)</pre></code></td></tr><tr><td>92</td><td><code><pre>        }</pre></code></td></tr><tr><td>93</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>95</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_transport.Call">func transport.Call</div><div class="info"><a href="#s_fn_transport.Call">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>107</td><td><code><pre>func (t *transport) Call(method string, params []string) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>        defer func() { t.nextReqID++ }()</pre></code></td></tr><tr><td>109</td><td><code><pre></pre></code></td></tr><tr><td>110</td><td><code><pre>        // Setup a continuation channel</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>        ch := make(chan []byte)</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>        t.continuations[t.nextReqID] = ch</pre></code></td></tr><tr><td>113</td><td><code><pre></pre></code></td></tr><tr><td>114</td><td><code><pre>        // Ensure we cleanup.</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>116</td><td><code><pre>                delete(t.continuations, t.nextReqID)</pre></code></td></tr><tr><td>117</td><td><code><pre>                close(ch)</pre></code></td></tr><tr><td>118</td><td><code><pre>        }()</pre></code></td></tr><tr><td>119</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        for i := uint8(0); i &lt; t.maxRetries+1; i++ {</pre></code></td></tr><tr><td>121</td><td><code><pre>                // Perform the call</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>                err := t.call(t.nextReqID, method, params)</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>                        return nil, err</pre></code></td></tr><tr><td>125</td><td><code><pre>                }</pre></code></td></tr><tr><td>126</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                select {</pre></code></td></tr><tr><td>128</td><td><code><pre>                case data := &lt;-ch:</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>                        return data, nil</pre></code></td></tr><tr><td>130</td><td><code><pre>                case &lt;-t.clock.After(transportTimeout):</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>                        common.Log.Infof(&#34;Timed out whilst waiting for response.&#34;)</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>133</td><td><code><pre>                }</pre></code></td></tr><tr><td>134</td><td><code><pre>        }</pre></code></td></tr><tr><td>135</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        err := fmt.Errorf(&#34;Max retries exceeded whilst sending request to device %s&#34;, t.address)</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        common.Log.Error(err)</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        return nil, err</pre></code></td></tr><tr><td>139</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewCrypto">func NewCrypto</div><div class="info"><a href="#s_fn_NewCrypto">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func NewCrypto(deviceID uint32, deviceToken []byte, initialStamp uint32, stampTime time.Time, clock clock.Clock) (</pre></code></td></tr><tr><td>32</td><td><code><pre>        Crypto, error) {</pre></code></td></tr><tr><td>33</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        hash := md5.New()</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        _, err := hash.Write(deviceToken)</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>38</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        key := hash.Sum(nil)</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        hash = md5.New()</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        _, err = hash.Write(key)</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        _, err = hash.Write(deviceToken)</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>49</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        iv := hash.Sum(nil)</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        return &amp;crypto{</pre></code></td></tr><tr><td>53</td><td><code><pre>                deviceId:     deviceID,</pre></code></td></tr><tr><td>54</td><td><code><pre>                deviceToken:  deviceToken,</pre></code></td></tr><tr><td>55</td><td><code><pre>                initialStamp: initialStamp,</pre></code></td></tr><tr><td>56</td><td><code><pre>                stampTime:    stampTime,</pre></code></td></tr><tr><td>57</td><td><code><pre>                clock:        clock,</pre></code></td></tr><tr><td>58</td><td><code><pre></pre></code></td></tr><tr><td>59</td><td><code><pre>                iv:  iv,</pre></code></td></tr><tr><td>60</td><td><code><pre>                key: key,</pre></code></td></tr><tr><td>61</td><td><code><pre>        }, nil</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_transport.call">func transport.call</div><div class="info"><a href="#s_fn_transport.call">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>142</td><td><code><pre>func (t *transport) call(requestId uint32, method string, params []string) (err error) {</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>        if params == nil {</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>                params = make([]string, 0)</pre></code></td></tr><tr><td>145</td><td><code><pre>        }</pre></code></td></tr><tr><td>146</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        data, err := json.Marshal(request{</pre></code></td></tr><tr><td>148</td><td><code><pre>                ID:     requestId,</pre></code></td></tr><tr><td>149</td><td><code><pre>                Method: method,</pre></code></td></tr><tr><td>150</td><td><code><pre>                Params: params,</pre></code></td></tr><tr><td>151</td><td><code><pre>        })</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                return</pre></code></td></tr><tr><td>154</td><td><code><pre>        }</pre></code></td></tr><tr><td>155</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>        p, err := t.crypto.NewPacket(data)</pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>158</td><td><code><pre>                return</pre></code></td></tr><tr><td>159</td><td><code><pre>        }</pre></code></td></tr><tr><td>160</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>        err = t.Send(p)</pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>        return</pre></code></td></tr><tr><td>163</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.NewPacket">func crypto.NewPacket</div><div class="info"><a href="#s_fn_crypto.NewPacket">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>117</td><td><code><pre>func (c *crypto) NewPacket(data []byte) (*Packet, error) {</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        encrypted, err := c.Encrypt(data)</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>121</td><td><code><pre>        }</pre></code></td></tr><tr><td>122</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>        stamp := c.getStamp()</pre></code></td></tr><tr><td>124</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>        p := New(c.deviceId, c.deviceToken, stamp, encrypted)</pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        err = p.WriteChecksum()</pre></code></td></tr><tr><td>127</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>130</td><td><code><pre>        }</pre></code></td></tr><tr><td>131</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>        return p, nil</pre></code></td></tr><tr><td>133</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.Encrypt">func crypto.Encrypt</div><div class="info"><a href="#s_fn_crypto.Encrypt">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>81</td><td><code><pre>func (c *crypto) Encrypt(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        block, err := aes.NewCipher(c.key)</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>85</td><td><code><pre>        }</pre></code></td></tr><tr><td>86</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>        data = c.pkcs5Pad(data, block.BlockSize())</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>        stream := cipher.NewCBCEncrypter(block, c.iv)</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        encrypted := make([]byte, len(data))</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>        stream.CryptBlocks(encrypted, []byte(data))</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        return encrypted, nil</pre></code></td></tr><tr><td>93</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.Decrypt">func crypto.Decrypt</div><div class="info"><a href="#s_fn_crypto.Decrypt">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>69</td><td><code><pre>func (c *crypto) Decrypt(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        block, err := aes.NewCipher(c.key)</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>        stream := cipher.NewCBCDecrypter(block, c.iv)</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        decrypted := make([]byte, len(data))</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        stream.CryptBlocks(decrypted, data)</pre></code></td></tr><tr><td>77</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>        return c.pkcs5Unpad(decrypted, block.BlockSize())</pre></code></td></tr><tr><td>79</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.pkcs5Unpad">func crypto.pkcs5Unpad</div><div class="info"><a href="#s_fn_crypto.pkcs5Unpad">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>104</td><td><code><pre>func (c *crypto) pkcs5Unpad(data []byte, blockSize int) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        srcLen := len(data)</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>        paddingLen := int(data[srcLen-1])</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        if paddingLen &gt;= srcLen || paddingLen &gt; blockSize {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                return nil, fmt.Errorf(&#34;Padding size error whilst decrypting payload.&#34;)</pre></code></td></tr><tr><td>109</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        return data[:srcLen-paddingLen], nil</pre></code></td></tr><tr><td>111</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_transport.CallAndDeserialize">func transport.CallAndDeserialize</div><div class="info"><a href="#s_fn_transport.CallAndDeserialize">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>97</td><td><code><pre>func (t *transport) CallAndDeserialize(method string, params []string, dest interface{}) error {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>        resp, err := t.Call(method, params)</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        err = json.Unmarshal(resp, dest)</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                return err</pre></code></td></tr><tr><td>102</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>104</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.pkcs5Pad">func crypto.pkcs5Pad</div><div class="info"><a href="#s_fn_crypto.pkcs5Pad">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>96</td><td><code><pre>func (c *crypto) pkcs5Pad(data []byte, blockSize int) []byte {</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        length := len(data)</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>        padLength := (blockSize - (length % blockSize))</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        pad := bytes.Repeat([]byte{byte(padLength)}, padLength)</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        return append(data, pad...)</pre></code></td></tr><tr><td>101</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_transport.Send">func transport.Send</div><div class="info"><a href="#s_fn_transport.Send">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>165</td><td><code><pre>func (t *transport) Send(packet *Packet) error {</pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        common.Log.Debugf(&#34;Sending packet with checksum: %s&#34;, hex.EncodeToString(packet.Header.Checksum))</pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>        _, err := t.requestSocket.WriteTo(packet.Serialize(), t.address)</pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>        return err</pre></code></td></tr><tr><td>169</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewHello">func NewHello</div><div class="info"><a href="#s_fn_NewHello">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/packet.go</code>:</p></div><table class="listing">
<tr><td>119</td><td><code><pre>func NewHello() *Packet {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        checksum := bytes.Repeat([]byte{0xff}, 16)</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        return &amp;Packet{</pre></code></td></tr><tr><td>122</td><td><code><pre>                Header: Header{</pre></code></td></tr><tr><td>123</td><td><code><pre>                        Magic:    0x2131,</pre></code></td></tr><tr><td>124</td><td><code><pre>                        Length:   0x0020,</pre></code></td></tr><tr><td>125</td><td><code><pre>                        F1:       0xffffffff,</pre></code></td></tr><tr><td>126</td><td><code><pre>                        DeviceID: 0xffffffff,</pre></code></td></tr><tr><td>127</td><td><code><pre>                        Stamp:    0xffffffff,</pre></code></td></tr><tr><td>128</td><td><code><pre>                        Checksum: checksum,</pre></code></td></tr><tr><td>129</td><td><code><pre>                },</pre></code></td></tr><tr><td>130</td><td><code><pre>        }</pre></code></td></tr><tr><td>131</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@115:8">func @115:8</div><div class="info"><a href="#s_fn_@115:8">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>115</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>                delete(t.continuations, t.nextReqID)</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>                close(ch)</pre></code></td></tr><tr><td>118</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_NewTransport">func NewTransport</div><div class="info"><a href="#s_fn_NewTransport">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr><td>49</td><td><code><pre>func NewTransport(maxRetries uint8, crypto Crypto, address net.Addr, requestSocket Connection,</pre></code></td></tr><tr><td>50</td><td><code><pre>        clock clock.Clock) Transport {</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        return &amp;transport{</pre></code></td></tr><tr><td>53</td><td><code><pre>                maxRetries:    maxRetries,</pre></code></td></tr><tr><td>54</td><td><code><pre>                crypto:        crypto,</pre></code></td></tr><tr><td>55</td><td><code><pre>                address:       address,</pre></code></td></tr><tr><td>56</td><td><code><pre>                requestSocket: requestSocket,</pre></code></td></tr><tr><td>57</td><td><code><pre>                clock:         clock,</pre></code></td></tr><tr><td>58</td><td><code><pre></pre></code></td></tr><tr><td>59</td><td><code><pre>                nextReqID:     1,</pre></code></td></tr><tr><td>60</td><td><code><pre>                continuations: make(map[uint32]chan []byte),</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.VerifyPacket">func crypto.VerifyPacket</div><div class="info"><a href="#s_fn_crypto.VerifyPacket">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>64</td><td><code><pre>func (c *crypto) VerifyPacket(pkt *Packet) error {</pre></code></td></tr><tr><td>65</td><td><code><pre>        // Verify the checksum.</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        return pkt.Verify(c.deviceToken)</pre></code></td></tr><tr><td>67</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@108:8">func @108:8</div><div class="info"><a href="#s_fn_@108:8">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/transport.go</code>:</p></div><table class="listing">
<tr class="miss"><td>108</td><td><code><pre>func() { t.nextReqID++ }</pre></code></td></tr></table>

<div class="funcname" id="fn_crypto.getStamp">func crypto.getStamp</div><div class="info"><a href="#s_fn_crypto.getStamp">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/protocol/packet/crypto.go</code>:</p></div><table class="listing">
<tr><td>113</td><td><code><pre>func (c *crypto) getStamp() uint32 {</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>        return uint32(c.clock.Now().Sub(c.stampTime).Seconds()) + c.initialStamp</pre></code></td></tr><tr><td>115</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/protocol/packet DONE:21.58
-->

<div id="pkg_github.com/nickw444/miio-go/subscription" class="funcname">Package Overview: github.com/nickw444/miio-go/subscription <span class="packageTotal">0.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/nickw444/miio-go/subscription</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/nickw444/miio-go/subscription | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_Subscription.Write"><td><code><a href="#fn_Subscription.Write">Subscription.Write(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_Subscription.Close"><td><code><a href="#fn_Subscription.Close">Subscription.Close(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_subscriptionTarget.Publish"><td><code><a href="#fn_subscriptionTarget.Publish">subscriptionTarget.Publish(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_subscriptionTarget.CloseAllSubscriptions"><td><code><a href="#fn_subscriptionTarget.CloseAllSubscriptions">subscriptionTarget.CloseAllSubscriptions(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_subscriptionTarget.NewSubscription"><td><code><a href="#fn_subscriptionTarget.NewSubscription">subscriptionTarget.NewSubscription(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_subscriptionTarget.CloseSubscription"><td><code><a href="#fn_subscriptionTarget.CloseSubscription">subscriptionTarget.CloseSubscription(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_NewTarget"><td><code><a href="#fn_NewTarget">NewTarget(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_subscriptionTarget.HasSubscribers"><td><code><a href="#fn_subscriptionTarget.HasSubscribers">subscriptionTarget.HasSubscribers(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Subscription.ID"><td><code><a href="#fn_Subscription.ID">Subscription.ID(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Subscription.Events"><td><code><a href="#fn_Subscription.Events">Subscription.Events(...)</a></code></td><td><code>github.com/nickw444/miio-go/subscription/subscription.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/nickw444/miio-go/subscription</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/34</code></td></tr>
</table>

<div class="funcname" id="fn_Subscription.Write">func Subscription.Write</div><div class="info"><a href="#s_fn_Subscription.Write">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func (s *Subscription) Write(event interface{}) error {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>        s.wg.Add(1)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        defer s.wg.Done()</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>        timeout := time.After(defaultTimeout)</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        select {</pre></code></td></tr><tr><td>42</td><td><code><pre>        case &lt;-s.quitChan:</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                return ErrClosed</pre></code></td></tr><tr><td>44</td><td><code><pre>        default:</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        select {</pre></code></td></tr><tr><td>47</td><td><code><pre>        case &lt;-s.quitChan:</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                return ErrClosed</pre></code></td></tr><tr><td>49</td><td><code><pre>        case s.events &lt;- event:</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>51</td><td><code><pre>        case &lt;-timeout:</pre></code></td></tr><tr><td>52</td><td><code><pre>                //Log.Debugf(&#34;Timeout on subscription %s&#34;, s.ID)</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>                return ErrTimeout</pre></code></td></tr><tr><td>54</td><td><code><pre>        }</pre></code></td></tr><tr><td>55</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Subscription.Close">func Subscription.Close</div><div class="info"><a href="#s_fn_Subscription.Close">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>57</td><td><code><pre>func (s *Subscription) Close() error {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        select {</pre></code></td></tr><tr><td>59</td><td><code><pre>        case &lt;-s.quitChan:</pre></code></td></tr><tr><td>60</td><td><code><pre>                //Log.Warnf(&#34;Subscription %s already closed&#34;, s.ID)</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>                return ErrClosed</pre></code></td></tr><tr><td>62</td><td><code><pre>        default:</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>                close(s.quitChan)</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                s.wg.Wait()</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                close(s.events)</pre></code></td></tr><tr><td>66</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        return s.target.CloseSubscription(s)</pre></code></td></tr><tr><td>68</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_subscriptionTarget.Publish">func subscriptionTarget.Publish</div><div class="info"><a href="#s_fn_subscriptionTarget.Publish">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>92</td><td><code><pre>func (t *subscriptionTarget) Publish(event interface{}) error {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>        for _, sub := range t.subscriptions {</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>                err := sub.Write(event)</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>97</td><td><code><pre>                }</pre></code></td></tr><tr><td>98</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>100</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_subscriptionTarget.CloseAllSubscriptions">func subscriptionTarget.CloseAllSubscriptions</div><div class="info"><a href="#s_fn_subscriptionTarget.CloseAllSubscriptions">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>118</td><td><code><pre>func (t *subscriptionTarget) CloseAllSubscriptions() error {</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        for _, sub := range t.subscriptions {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                err := t.CloseSubscription(sub)</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>123</td><td><code><pre>                }</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>127</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_subscriptionTarget.NewSubscription">func subscriptionTarget.NewSubscription</div><div class="info"><a href="#s_fn_subscriptionTarget.NewSubscription">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>102</td><td><code><pre>func (t *subscriptionTarget) NewSubscription() (*Subscription, error) {</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        sub := &amp;Subscription{</pre></code></td></tr><tr><td>104</td><td><code><pre>                events:   make(chan interface{}, chanSize),</pre></code></td></tr><tr><td>105</td><td><code><pre>                quitChan: make(chan struct{}),</pre></code></td></tr><tr><td>106</td><td><code><pre>                id:       uuid.NewV4(),</pre></code></td></tr><tr><td>107</td><td><code><pre>                target:   t,</pre></code></td></tr><tr><td>108</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>        t.subscriptions[sub.ID()] = sub</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        return sub, nil</pre></code></td></tr><tr><td>111</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_subscriptionTarget.CloseSubscription">func subscriptionTarget.CloseSubscription</div><div class="info"><a href="#s_fn_subscriptionTarget.CloseSubscription">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>113</td><td><code><pre>func (t *subscriptionTarget) CloseSubscription(s *Subscription) error {</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>        delete(t.subscriptions, s.ID())</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>116</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewTarget">func NewTarget</div><div class="info"><a href="#s_fn_NewTarget">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>82</td><td><code><pre>func NewTarget() SubscriptionTarget {</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        return &amp;subscriptionTarget{</pre></code></td></tr><tr><td>84</td><td><code><pre>                subscriptions: make(map[string]*Subscription),</pre></code></td></tr><tr><td>85</td><td><code><pre>        }</pre></code></td></tr><tr><td>86</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_subscriptionTarget.HasSubscribers">func subscriptionTarget.HasSubscribers</div><div class="info"><a href="#s_fn_subscriptionTarget.HasSubscribers">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>88</td><td><code><pre>func (t *subscriptionTarget) HasSubscribers() bool {</pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>        return len(t.subscriptions) &gt; 0</pre></code></td></tr><tr><td>90</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Subscription.ID">func Subscription.ID</div><div class="info"><a href="#s_fn_Subscription.ID">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>29</td><td><code><pre>func (s *Subscription) ID() string {</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        return s.id.String()</pre></code></td></tr><tr><td>31</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Subscription.Events">func Subscription.Events</div><div class="info"><a href="#s_fn_Subscription.Events">Back</a><p>In <code>/Users/nickw/go/src/github.com/nickw444/miio-go/subscription/subscription.go</code>:</p></div><table class="listing">
<tr><td>33</td><td><code><pre>func (s *Subscription) Events() &lt;-chan interface{} {</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        return s.events</pre></code></td></tr><tr><td>35</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/nickw444/miio-go/subscription DONE:0.00
-->

<div id="summaryWrapper"><div class="package">Report Total</div>
<div id="totalcov">26.11%</div>
</div>
    </body>
